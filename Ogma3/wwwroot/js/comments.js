var d="GET",r="POST";async function i(e,t,n,o,s){let a=await fetch(e,{method:t,headers:{"content-type":"application/json",...o},body:n&&JSON.stringify(n),...s}),l=a.headers.get("content-type")?.includes("application/json")?await a.json():await a.text();return{ok:a.ok,status:a.status,statusText:a.statusText,headers:a.headers,data:l}}var u=async(e,t,n,o,s)=>await i(`/api/comments?thread=${e}&page=${t}&highlight=${n}`,d,void 0,o,s);var p=async(e,t,n)=>await i(`/api/CommentsThread/${e}`,d,void 0,t,n);var m=async(e,t,n)=>await i("/api/comments",r,e,t,n),c=async(e,t,n)=>await i("/api/CommentsThread/lock",r,e,t,n);new Vue({el:"#comments-container",data:{body:"",thread:null,csrf:null,type:null,minLength:0,maxLength:0,comments:[],total:0,page:1,perPage:10,opName:null,authenticatedAs:!1,canLock:!1,isSubscribed:!1,isLocked:!1,highlight:null,collapse:JSON.parse(window.localStorage.getItem("collapse-deleted")),isReady:!1},methods:{submit:async function(e){if(e.preventDefault(),this.body.length>=this.maxLength)return;if(!(await m({body:this.body,thread:Number(this.thread),source:this.type},{RequestVerificationToken:this.csrf})).ok)return;this.highlight=this.total+1,this.page=1,await this.load(),this.body=""},load:async function(){let e=await u(this.thread,this.page,this.highlight??-1),t=e.data;if(this.total=t.total,this.page=t.page??this.page,this.authenticatedAs=e.headers.get("x-username").toLowerCase(),this.comments=Object.entries(t.elements).map(([n,o])=>({val:o,key:t.total-this.page*this.perPage+(this.perPage-(Number.parseInt(n)+1))})),this.highlight)this.$nextTick(()=>this.changeHighlight());else this.navigateToPage();if(this.isReady)return;this.$nextTick(function(){this.isReady=!0})},enter:async function(e){if(e.ctrlKey)await this.submit(e)},prevPage:async function(){await this.changePage(Math.max(1,this.page-1))},nextPage:async function(){await this.changePage(Math.min(this.page+1,Math.ceil(this.total/this.perPage)))},changePage:async function(e){this.page=e,this.navigateToPage(),await this.load()},changeHighlight:function(e=null,t=null){if(t)t.preventDefault();this.highlight=e??this.highlight,document.getElementById(`comment-${this.highlight}`).scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),history.replaceState(void 0,void 0,`#comment-${this.highlight}`)},navigateToPage:function(){let e=this.page>1?`#page-${this.page}`:window.location.href.split("#")[0];if(history.replaceState(null,null,e),this.highlight)this.highlight=null},report:function(e){this.$refs.reportModal.mutId=e,this.$refs.reportModal.visible=!0},lock:async function(){if(!this.canLock)return!1;let e=await c({threadId:this.thread});return this.isLocked=e.ok&&e.data,this.isLocked}},computed:{comms:function(){if(this.collapse!==!0)return this.comments;let e=[],t=0;for(let n of this.comments)if(!n.val.deletedBy){if(t!==0)e.push({snip:`Removed ${t} comments.`});t=0,e.push(n)}else t+=1;return e}},async mounted(){let e=this.$refs.container;this.csrf=e.dataset.csrf,this.thread=e.dataset.id;let t=async()=>{let s=await p(this.thread);if(s.ok){this.canLock=s.headers.get("X-IsStaff").toLowerCase()==="true";let a=s.data;this.isLocked=a.isLocked,this.perPage=a.perPage,this.minLength=a.minCommentLength,this.maxLength=a.maxCommentLength,this.type=a.source}},n=async()=>{await this.load()};await Promise.allSettled([t(),n()]);let o=window.location.hash.split("-");if(o[0]==="#page"&&o[1])this.page=Math.max(1,Number(o[1]??1));else if(o[0]==="#comment"&&o[1])this.page=1,this.highlight=Number(o[1]);else this.page=1,history.replaceState(void 0,void 0,"")}});

//# debugId=0DDA62BD0EA4487464756E2164756E21
