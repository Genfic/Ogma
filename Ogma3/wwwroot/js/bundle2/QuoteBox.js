import{c as m,l as Z}from"./chunk-rnytdpz1.js";import{v as C}from"./Icon.js";import{A as z,B as t,C as O,D as G,F as y,H as J,I as P,J as U,L as V,N as T,R as F,S as K,T as L,aa as W,ga as X,ja as Y,x as j,y as x,z as D}from"./chunk-hmv3z8hd.js";var o=T('<em class="body svelte-14y8kxxqo9cho"> </em> <span class="author svelte-14y8kxxqo9cho"> </span>',1),Q=T("<span>Loading the quote...</span>"),r=T("<span>Could not load quote.</span>"),u=T('<div class="quote-box svelte-14y8kxxqo9cho"><div id="quote" class="quote active-border svelte-14y8kxxqo9cho"><div class="refresh svelte-14y8kxxqo9cho"><!></div> <!></div></div>');function M(H,I){P(I,!0);let s=j(!0),f=j(null),p=j(!0),S=D(()=>y(p)?"lucide:refresh-cw":"lucide:clock"),A=D(()=>y(s)?"spin":"");async function v(){if(!y(p)||y(s))return;x(s,!0);try{let i=await Z();if(i.ok){x(f,i.data,!0);try{window.localStorage.setItem("quote",JSON.stringify(y(f)))}catch(b){m.warn("Could not save quote to localStorage",b)}}else if(i.status===429){m.warn("Rate limit hit (429), attempting to load quote from localStorage.");try{let b=window.localStorage.getItem("quote");if(b)x(f,JSON.parse(b),!0);else m.warn("No quote found in localStorage."),x(f,{body:"Rate limited. Please try again later.",author:"System"},!0)}catch(b){m.error("Failed to parse quote from localStorage",b),x(f,{body:"Error loading cached quote.",author:"System"},!0)}}else m.error(`Failed to fetch quote: ${i.statusText}`),x(f,{body:"Could not load quote.",author:"System"},!0);let c=i.headers?.get("retry-after"),h=c?parseInt(c,10):60;if(!isNaN(h)&&h>0)x(p,!1),setTimeout(()=>{x(p,!0)},h*1000);else x(p,!0)}catch(i){m.error("Error during quote fetch:",i),x(f,{body:"An error occurred while fetching the quote.",author:"System"},!0),x(p,!0)}finally{x(s,!1)}}X(()=>{try{let i=window.localStorage.getItem("quote");if(i)x(f,JSON.parse(i),!0),x(s,!1);else v()}catch(i){m.error("Failed to parse initial quote from localStorage",i),v()}});var w=u(),N=t(w),E=t(N),B=t(E);C(B,{get icon(){return y(S)},get class(){return`material-icons-outlined ${y(A)??""}`}}),z(E);var g=G(E,2);{var q=(i)=>{var c=o(),h=O(c),b=t(h,!0);z(h);var k=G(h,2),l=t(k,!0);z(k),J(()=>{K(b,y(f).body),K(l,y(f).author)}),F(i,c)},R=(i,c)=>{{var h=(k)=>{var l=Q();F(k,l)},b=(k)=>{var l=r();F(k,l)};L(i,(k)=>{if(y(s))k(h);else k(b,!1)},c)}};L(g,(i)=>{if(y(f))i(q);else i(R,!1)})}z(N),z(w),J(()=>W(E,"title",y(p)?"Get new quote":"Please wait")),V("click",E,v),F(H,w),U()}var ci=M;if(customElements.get("my-element")==null)customElements.define("my-element",Y(M,{},[],[],!0));export{ci as default};

//# debugId=521362E16A3573DB64756E2164756E21
//# sourceMappingURL=QuoteBox.js.map
