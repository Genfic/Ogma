import{a as m1}from"./Modal.js";import{c as e,e as S,m as $,n as t1,r as d1}from"./chunk-rnytdpz1.js";import{v as i1}from"./Icon.js";import{$ as f,A as v,B as g,C as O,D as Q,F as t,H as s,I as r,J as R,L as V,N as b,R as x,S as C,T as G,U as I,_ as l,da as _,ja as h,w as L,x as u,y as i,z as T}from"./chunk-hmv3z8hd.js";var E1=b("<p>Loading shelves...</p>"),n1=b('<p class="error svelte-1wvhr5syu2ud1"> </p>'),G1=b(`<p>You don't have any shelves yet. <a href="/shelves">Create one?</a></p>`),H1=b('<span class="spinner svelte-1wvhr5syu2ud1">(updating...)</span>'),J1=b('<li class="svelte-1wvhr5syu2ud1"><label class="svelte-1wvhr5syu2ud1"><input type="checkbox"> </label> <!></li>'),K1=b('<ul class="svelte-1wvhr5syu2ud1"></ul>'),N1=b('<div class="shelf-list svelte-1wvhr5syu2ud1"><!></div>'),P1=b('<div slot="footer"><button class="button secondary svelte-1wvhr5syu2ud1">Done</button></div>'),Q1=b('<button class="button icon-button svelte-1wvhr5syu2ud1" title="Add to shelf"><!></button> <!>',1);function x1(b1,H){r(H,!0);let J=u(null),W=u(L([])),c=u(L(new Set)),X=u(!0),K=u(null),w=u(null);async function y1(){i(X,!0),i(w,null);try{let[d,y]=await Promise.all([t1(),$(H.storyId)]);if(d.ok)i(W,d.data??[],!0);else e.error("Failed to load all shelves:",d.statusText),i(w,"Could not load shelves.");if(y.ok)i(c,new Set((y.data??[]).map((m)=>m.id)),!0);else e.error("Failed to load story shelves:",y.statusText)}catch(d){e.error("Error loading shelf data:",d),i(w,"An error occurred while loading shelf data.")}finally{i(X,!1)}}function w1(){y1(),t(J)?.openModal()}async function o1(d,y){if(t(K)!==null)return;i(K,d,!0),i(w,null);let m=y?S:d1,j={shelfId:d,bookId:H.storyId};try{let o=await m(j,{RequestVerificationToken:H.csrf});if(o.ok){if(y)t(c).delete(d);else t(c).add(d);i(c,t(c),!0)}else e.error(`Failed to ${y?"remove from":"add to"} shelf:`,o.statusText),i(w,`Failed to update shelf: ${o.data?.message||o.statusText}`)}catch(o){e.error("Error updating shelf:",o),i(w,"An unexpected error occurred.")}finally{i(K,null)}}var U=Q1(),N=O(U),v1=g(N);i1(v1,{icon:"lucide:book-plus"}),v(N);var u1=Q(N,2);_(m1(u1,{label:"Manage Shelves",children:(d,y)=>{var m=N1(),j=g(m);{var o=(p)=>{var Y=E1();x(p,Y)},g1=(p,Y)=>{{var c1=(z)=>{var A=n1(),Z=g(A,!0);v(A),s(()=>C(Z,t(w))),x(z,A)},p1=(z,A)=>{{var Z=(k)=>{var E=G1();x(k,E)},z1=(k)=>{var E=K1();I(E,21,()=>t(W),(D)=>D.id,(D,P)=>{var F=J1();let a=T(()=>t(c).has(t(P).id)),q=T(()=>t(K)===t(P).id);var M=g(F),n=g(M);l(n);var k1=Q(n);v(M);var e1=Q(M,2);{var j1=(B)=>{var A1=H1();x(B,A1)};G(e1,(B)=>{if(t(q))B(j1)})}v(F),s(()=>{f(n,t(a)),n.disabled=t(q),C(k1,` ${t(P).name??""}`)}),V("change",n,()=>o1(t(P).id,t(a))),x(D,F)}),v(E),x(k,E)};G(z,(k)=>{if(t(W).length===0)k(Z);else k(z1,!1)},A)}};G(p,(z)=>{if(t(w))z(c1);else z(p1,!1)},Y)}};G(j,(p)=>{if(t(X))p(o);else p(g1,!1)})}v(m),x(d,m)},$$slots:{default:!0,footer:(d,y)=>{var m=P1(),j=g(m);v(m),V("click",j,()=>t(J)?.closeModal()),x(d,m)}}}),(d)=>i(J,d,!0),()=>t(J)),V("click",N,w1),x(b1,U),R()}var r1=x1;if(customElements.get("my-element")==null)customElements.define("my-element",h(x1,{storyId:{},csrf:{}},[],[],!0));export{r1 as default};

//# debugId=FAA769171A0B5C2664756E2164756E21
//# sourceMappingURL=ShelvesButton.js.map
