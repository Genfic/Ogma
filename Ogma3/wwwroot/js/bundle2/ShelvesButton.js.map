{
  "version": 3,
  "sources": ["..\\..\\..\\FrontendCode\\typescript\\svelte-webcomponents\\ShelvesButton.svelte"],
  "sourcesContent": [
    "import 'svelte/internal/disclose-version';\nimport * as $ from 'svelte/internal/client';\nimport { onMount } from \"svelte\";\nimport { log } from \"../src-helpers/logger\";\n\nimport {\n\tGetApiShelfStories as getStoryShelves,\n\tGetApiShelves as getAllShelves,\n\tPostApiShelfStories as addToShelf,\n\tDeleteApiShelfStories as removeFromShelf\n} from \"../generated/paths-public\";\n\nimport Modal from \"./Modal.svelte\"; // Use the generic modal\nimport Icon from \"./Icon.svelte\"; // Use Icon component\n\nvar root_2 = $.template(`<p>Loading shelves...</p>`);\nvar root_4 = $.template(`<p class=\"error svelte-1wvhr5syu2ud1\"> </p>`);\nvar root_6 = $.template(`<p>You don't have any shelves yet. <a href=\"/shelves\">Create one?</a></p>`);\nvar root_9 = $.template(`<span class=\"spinner svelte-1wvhr5syu2ud1\">(updating...)</span>`);\nvar root_8 = $.template(`<li class=\"svelte-1wvhr5syu2ud1\"><label class=\"svelte-1wvhr5syu2ud1\"><input type=\"checkbox\"> </label> <!></li>`);\nvar root_7 = $.template(`<ul class=\"svelte-1wvhr5syu2ud1\"></ul>`);\nvar root_1 = $.template(`<div class=\"shelf-list svelte-1wvhr5syu2ud1\"><!></div>`);\nvar root_10 = $.template(`<div slot=\"footer\"><button class=\"button secondary svelte-1wvhr5syu2ud1\">Done</button></div>`);\nvar root = $.template(`<button class=\"button icon-button svelte-1wvhr5syu2ud1\" title=\"Add to shelf\"><!></button> <!>`, 1);\n\nfunction ShelvesButton($$anchor, $$props) {\n\t$.push($$props, true);\n\n\t// State\n\tlet modalRef = $.state(null);\n\tlet allShelves = $.state($.proxy([]));\n\tlet storyShelfIds = $.state($.proxy(new Set())); // IDs of shelves this story is on\n\tlet isLoadingShelves = $.state(true);\n\tlet isUpdatingShelf = $.state(null); // ID of shelf being updated, or null\n\tlet error = $.state(null);\n\n\tasync function loadData() {\n\t\t$.set(isLoadingShelves, true);\n\t\t$.set(error, null);\n\n\t\ttry {\n\t\t\tconst [allShelvesRes, storyShelvesRes] = await Promise.all([\n\t\t\t\tgetAllShelves(),\n\t\t\t\tgetStoryShelves($$props.storyId)\n\t\t\t]);\n\n\t\t\tif (allShelvesRes.ok) {\n\t\t\t\t$.set(allShelves, allShelvesRes.data ?? [], true);\n\t\t\t} else {\n\t\t\t\tlog.error(\"Failed to load all shelves:\", allShelvesRes.statusText);\n\t\t\t\t$.set(error, \"Could not load shelves.\");\n\t\t\t}\n\n\t\t\tif (storyShelvesRes.ok) {\n\t\t\t\t$.set(storyShelfIds, new Set((storyShelvesRes.data ?? []).map((s) => s.id)), true);\n\t\t\t} else {\n\t\t\t\tlog.error(\"Failed to load story shelves:\", storyShelvesRes.statusText); // Don't necessarily set error state here if all shelves loaded ok\n\t\t\t}\n\t\t} catch(err) {\n\t\t\tlog.error(\"Error loading shelf data:\", err);\n\t\t\t$.set(error, \"An error occurred while loading shelf data.\");\n\t\t} finally {\n\t\t\t$.set(isLoadingShelves, false);\n\t\t}\n\t}\n\n\tfunction openShelvesModal() {\n\t\t// Load data when modal is opened\n\t\tloadData();\n\t\t$.get(modalRef)?.openModal();\n\t}\n\n\tasync function handleShelfToggle(shelfId, isCurrentlyOnShelf) {\n\t\tif ($.get(isUpdatingShelf) !== null) return; // Prevent concurrent updates\n\t\t$.set(isUpdatingShelf, shelfId, true);\n\t\t$.set(error, null); // Clear previous errors\n\n\t\tconst action = isCurrentlyOnShelf ? removeFromShelf : addToShelf;\n\t\tconst params = { shelfId, bookId: $$props.storyId }; // Assuming bookId corresponds to storyId\n\n\t\ttry {\n\t\t\tconst result = await action(params, { RequestVerificationToken: $$props.csrf });\n\n\t\t\tif (result.ok) {\n\t\t\t\t// Update the local state optimistically or based on response\n\t\t\t\tif (isCurrentlyOnShelf) {\n\t\t\t\t\t$.get(storyShelfIds).delete(shelfId);\n\t\t\t\t} else {\n\t\t\t\t\t$.get(storyShelfIds).add(shelfId);\n\t\t\t\t}\n\n\t\t\t\t// Force reactivity update for the Set\n\t\t\t\t$.set(storyShelfIds, $.get(storyShelfIds), true);\n\t\t\t} else {\n\t\t\t\tlog.error(`Failed to ${isCurrentlyOnShelf ? \"remove from\" : \"add to\"} shelf:`, result.statusText);\n\t\t\t\t$.set(error, `Failed to update shelf: ${result.data?.message || result.statusText}`);\n\t\t\t}\n\t\t} catch(err) {\n\t\t\tlog.error(\"Error updating shelf:\", err);\n\t\t\t$.set(error, \"An unexpected error occurred.\");\n\t\t} finally {\n\t\t\t$.set(isUpdatingShelf, null);\n\t\t}\n\t}\n\n\tvar fragment = root();\n\tvar button = $.first_child(fragment);\n\tvar node = $.child(button);\n\n\tIcon(node, { icon: 'lucide:book-plus' });\n\t$.reset(button);\n\n\tvar node_1 = $.sibling(button, 2);\n\n\t$.bind_this(\n\t\tModal(node_1, {\n\t\t\tlabel: 'Manage Shelves',\n\t\t\tchildren: ($$anchor, $$slotProps) => {\n\t\t\t\tvar div = root_1();\n\t\t\t\tvar node_2 = $.child(div);\n\n\t\t\t\t{\n\t\t\t\t\tvar consequent = ($$anchor) => {\n\t\t\t\t\t\tvar p = root_2();\n\n\t\t\t\t\t\t$.append($$anchor, p);\n\t\t\t\t\t};\n\n\t\t\t\t\tvar alternate = ($$anchor, $$elseif) => {\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar consequent_1 = ($$anchor) => {\n\t\t\t\t\t\t\t\tvar p_1 = root_4();\n\t\t\t\t\t\t\t\tvar text = $.child(p_1, true);\n\n\t\t\t\t\t\t\t\t$.reset(p_1);\n\t\t\t\t\t\t\t\t$.template_effect(() => $.set_text(text, $.get(error)));\n\t\t\t\t\t\t\t\t$.append($$anchor, p_1);\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tvar alternate_1 = ($$anchor, $$elseif) => {\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar consequent_2 = ($$anchor) => {\n\t\t\t\t\t\t\t\t\t\tvar p_2 = root_6();\n\n\t\t\t\t\t\t\t\t\t\t$.append($$anchor, p_2);\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tvar alternate_2 = ($$anchor) => {\n\t\t\t\t\t\t\t\t\t\tvar ul = root_7();\n\n\t\t\t\t\t\t\t\t\t\t$.each(ul, 21, () => $.get(allShelves), (shelf) => shelf.id, ($$anchor, shelf) => {\n\t\t\t\t\t\t\t\t\t\t\tvar li = root_8();\n\t\t\t\t\t\t\t\t\t\t\tconst isOnShelf = $.derived(() => $.get(storyShelfIds).has($.get(shelf).id));\n\t\t\t\t\t\t\t\t\t\t\tconst isUpdatingThis = $.derived(() => $.get(isUpdatingShelf) === $.get(shelf).id);\n\t\t\t\t\t\t\t\t\t\t\tvar label = $.child(li);\n\t\t\t\t\t\t\t\t\t\t\tvar input = $.child(label);\n\n\t\t\t\t\t\t\t\t\t\t\t$.remove_input_defaults(input);\n\n\t\t\t\t\t\t\t\t\t\t\tvar text_1 = $.sibling(input);\n\n\t\t\t\t\t\t\t\t\t\t\t$.reset(label);\n\n\t\t\t\t\t\t\t\t\t\t\tvar node_3 = $.sibling(label, 2);\n\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tvar consequent_3 = ($$anchor) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar span = root_9();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t$.append($$anchor, span);\n\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\t\t$.if(node_3, ($$render) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ($.get(isUpdatingThis)) $$render(consequent_3);\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t$.reset(li);\n\n\t\t\t\t\t\t\t\t\t\t\t$.template_effect(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t$.set_checked(input, $.get(isOnShelf));\n\t\t\t\t\t\t\t\t\t\t\t\tinput.disabled = $.get(isUpdatingThis);\n\t\t\t\t\t\t\t\t\t\t\t\t$.set_text(text_1, ` ${$.get(shelf).name ?? ''}`);\n\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t$.event('change', input, () => handleShelfToggle($.get(shelf).id, $.get(isOnShelf)));\n\t\t\t\t\t\t\t\t\t\t\t$.append($$anchor, li);\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t$.reset(ul);\n\t\t\t\t\t\t\t\t\t\t$.append($$anchor, ul);\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t$.if(\n\t\t\t\t\t\t\t\t\t\t$$anchor,\n\t\t\t\t\t\t\t\t\t\t($$render) => {\n\t\t\t\t\t\t\t\t\t\t\tif ($.get(allShelves).length === 0) $$render(consequent_2); else $$render(alternate_2, false);\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t$$elseif\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t$.if(\n\t\t\t\t\t\t\t\t$$anchor,\n\t\t\t\t\t\t\t\t($$render) => {\n\t\t\t\t\t\t\t\t\tif ($.get(error)) $$render(consequent_1); else $$render(alternate_1, false);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t$$elseif\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\t$.if(node_2, ($$render) => {\n\t\t\t\t\t\tif ($.get(isLoadingShelves)) $$render(consequent); else $$render(alternate, false);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t$.reset(div);\n\t\t\t\t$.append($$anchor, div);\n\t\t\t},\n\t\t\t$$slots: {\n\t\t\t\tdefault: true,\n\t\t\t\tfooter: ($$anchor, $$slotProps) => {\n\t\t\t\t\tvar div_1 = root_10();\n\t\t\t\t\tvar button_1 = $.child(div_1);\n\n\t\t\t\t\t$.reset(div_1);\n\t\t\t\t\t$.event('click', button_1, () => $.get(modalRef)?.closeModal());\n\t\t\t\t\t$.append($$anchor, div_1);\n\t\t\t\t}\n\t\t\t}\n\t\t}),\n\t\t($$value) => $.set(modalRef, $$value, true),\n\t\t() => $.get(modalRef)\n\t);\n\n\t$.event('click', button, openShelvesModal);\n\t$.append($$anchor, fragment);\n\t$.pop();\n}\n\nif (import.meta.hot) {\n\tShelvesButton = $.hmr(ShelvesButton, () => ShelvesButton[$.HMR].source);\n\n\timport.meta.hot.accept((module) => {\n\t\t$.cleanup_styles('svelte-1wvhr5syu2ud1');\n\t\tmodule.default[$.HMR].source = ShelvesButton[$.HMR].source;\n\t\t$.set(ShelvesButton[$.HMR].source, module.default[$.HMR].original);\n\t});\n}\n\nexport default ShelvesButton;\n\nif (customElements.get('my-element') == null) customElements.define('my-element', $.create_custom_element(ShelvesButton, { storyId: {}, csrf: {} }, [], [], true));\nimport \"bun-svelte:ShelvesButton.svelte-2jizmca5v2e8z-style.css\";"
  ],
  "mappings": "8VAeA,FAAI,bAAW,JAAS,2BAA2B,EAC/C,GAAW,EAAS,6CAA6C,EACjE,GAAW,EAAS,2EAA2E,EAC/F,GAAW,EAAS,iEAAiE,EACrF,GAAW,EAAS,gHAAgH,EACpI,GAAW,EAAS,wCAAwC,EAC5D,GAAW,EAAS,wDAAwD,EAC5E,GAAY,EAAS,8FAA8F,EACnH,GAAS,EAAS,gGAAiG,CAAC,EAExH,SAAS,EAAa,CAAC,GAAU,EAAS,CACvC,EAAK,EAAS,EAAI,EAGpB,IAAI,EAAa,EAAM,IAAI,EACvB,EAAe,EAAQ,EAAM,CAAC,CAAC,CAAC,EAChC,EAAkB,EAAQ,EAAM,IAAI,GAAK,CAAC,EAC1C,EAAqB,EAAM,EAAI,EAC/B,EAAoB,EAAM,IAAI,EAC9B,EAAU,EAAM,IAAI,EAExB,eAAe,EAAQ,EAAG,CACvB,EAAI,EAAkB,EAAI,EAC1B,EAAI,EAAO,IAAI,EAEjB,GAAI,CACH,IAAO,EAAe,GAAmB,MAAM,QAAQ,IAAI,CAC1D,GAAc,EACd,EAAgB,EAAQ,OAAO,CAChC,CAAC,EAED,GAAI,EAAc,GACf,EAAI,EAAY,EAAc,MAAQ,CAAC,EAAG,EAAI,EAEhD,OAAI,MAAM,8BAA+B,EAAc,UAAU,EAC/D,EAAI,EAAO,yBAAyB,EAGvC,GAAI,EAAgB,GACjB,EAAI,EAAe,IAAI,KAAK,EAAgB,MAAQ,CAAC,GAAG,IAAI,CAAC,IAAM,EAAE,EAAE,CAAC,EAAG,EAAI,EAEjF,OAAI,MAAM,gCAAiC,EAAgB,UAAU,EAErE,MAAM,EAAK,CACZ,EAAI,MAAM,4BAA6B,CAAG,EACxC,EAAI,EAAO,6CAA6C,SACzD,CACC,EAAI,EAAkB,EAAK,GAI/B,SAAS,EAAgB,EAAG,CAE3B,GAAS,EACP,EAAI,CAAQ,GAAG,UAAU,EAG5B,eAAe,EAAiB,CAAC,EAAS,EAAoB,CAC7D,GAAM,EAAI,CAAe,IAAM,KAAM,OACnC,EAAI,EAAiB,EAAS,EAAI,EAClC,EAAI,EAAO,IAAI,EAEjB,IAAM,EAAS,EAAqB,EAAkB,GAChD,EAAS,CAAE,UAAS,OAAQ,EAAQ,OAAQ,EAElD,GAAI,CACH,IAAM,EAAS,MAAM,EAAO,EAAQ,CAAE,yBAA0B,EAAQ,IAAK,CAAC,EAE9E,GAAI,EAAO,GAAI,CAEd,GAAI,EACD,EAAI,CAAa,EAAE,OAAO,CAAO,EAEnC,KAAE,EAAI,CAAa,EAAE,IAAI,CAAO,EAI/B,EAAI,EAAiB,EAAI,CAAa,EAAG,EAAI,EAE/C,OAAI,MAAM,aAAa,EAAqB,cAAgB,kBAAmB,EAAO,UAAU,EAC9F,EAAI,EAAO,2BAA2B,EAAO,MAAM,SAAW,EAAO,YAAY,EAEnF,MAAM,EAAK,CACZ,EAAI,MAAM,wBAAyB,CAAG,EACpC,EAAI,EAAO,+BAA+B,SAC3C,CACC,EAAI,EAAiB,IAAI,GAI7B,IAAI,EAAW,GAAK,EAChB,EAAW,EAAY,CAAQ,EAC/B,GAAS,EAAM,CAAM,EAEzB,GAAK,GAAM,CAAE,KAAM,kBAAmB,CAAC,EACrC,EAAM,CAAM,EAEd,IAAI,GAAW,EAAQ,EAAQ,CAAC,EAE9B,EACD,GAAM,GAAQ,CACb,MAAO,iBACP,SAAU,CAAC,EAAU,IAAgB,CACpC,IAAI,EAAM,GAAO,EACb,EAAW,EAAM,CAAG,EAExB,CACC,IAAI,EAAa,CAAC,IAAa,CAC9B,IAAI,EAAI,GAAO,EAEb,EAAO,EAAU,CAAC,GAGjB,GAAY,CAAC,EAAU,IAAa,CACvC,CACC,IAAI,GAAe,CAAC,IAAa,CAChC,IAAI,EAAM,GAAO,EACb,EAAS,EAAM,EAAK,EAAI,EAE1B,EAAM,CAAG,EACT,EAAgB,IAAQ,EAAS,EAAQ,EAAI,CAAK,CAAC,CAAC,EACpD,EAAO,EAAU,CAAG,GAGnB,GAAc,CAAC,EAAU,IAAa,CACzC,CACC,IAAI,EAAe,CAAC,IAAa,CAChC,IAAI,EAAM,GAAO,EAEf,EAAO,EAAU,CAAG,GAGnB,GAAc,CAAC,IAAa,CAC/B,IAAI,EAAK,GAAO,EAEd,EAAK,EAAI,GAAI,IAAQ,EAAI,CAAU,EAAG,CAAC,IAAU,EAAM,GAAI,CAAC,EAAU,IAAU,CACjF,IAAI,EAAK,GAAO,EAChB,IAAM,EAAc,EAAQ,IAAQ,EAAI,CAAa,EAAE,IAAM,EAAI,CAAK,EAAE,EAAE,CAAC,EACrE,EAAmB,EAAQ,IAAQ,EAAI,CAAe,IAAQ,EAAI,CAAK,EAAE,EAAE,EACjF,IAAI,EAAU,EAAM,CAAE,EAClB,EAAU,EAAM,CAAK,EAEvB,EAAsB,CAAK,EAE7B,IAAI,GAAW,EAAQ,CAAK,EAE1B,EAAM,CAAK,EAEb,IAAI,GAAW,EAAQ,EAAO,CAAC,EAE/B,CACC,IAAI,GAAe,CAAC,IAAa,CAChC,IAAI,GAAO,GAAO,EAEhB,EAAO,EAAU,EAAI,GAGtB,EAAG,GAAQ,CAAC,IAAa,CAC1B,GAAM,EAAI,CAAc,EAAG,EAAS,EAAY,EAChD,CACF,CAEE,EAAM,CAAE,EAER,EAAgB,IAAM,CACrB,EAAY,EAAS,EAAI,CAAS,CAAC,EACrC,EAAM,SAAa,EAAI,CAAc,EACnC,EAAS,GAAQ,IAAM,EAAI,CAAK,EAAE,MAAQ,IAAI,EAChD,EAEC,EAAM,SAAU,EAAO,IAAM,GAAoB,EAAI,CAAK,EAAE,GAAM,EAAI,CAAS,CAAC,CAAC,EACjF,EAAO,EAAU,CAAE,EACrB,EAEC,EAAM,CAAE,EACR,EAAO,EAAU,CAAE,GAGpB,EACD,EACA,CAAC,IAAa,CACb,GAAM,EAAI,CAAU,EAAE,SAAW,EAAG,EAAS,CAAY,EAAQ,OAAS,GAAa,EAAK,GAE7F,CACD,CACD,GAGC,EACD,EACA,CAAC,IAAa,CACb,GAAM,EAAI,CAAK,EAAG,EAAS,EAAY,EAAQ,OAAS,GAAa,EAAK,GAE3E,CACD,CACD,GAGC,EAAG,EAAQ,CAAC,IAAa,CAC1B,GAAM,EAAI,CAAgB,EAAG,EAAS,CAAU,EAAQ,OAAS,GAAW,EAAK,EACjF,CACF,CAEE,EAAM,CAAG,EACT,EAAO,EAAU,CAAG,GAEvB,QAAS,CACR,QAAS,GACT,OAAQ,CAAC,EAAU,IAAgB,CAClC,IAAI,EAAQ,GAAQ,EAChB,EAAa,EAAM,CAAK,EAE1B,EAAM,CAAK,EACX,EAAM,QAAS,EAAU,IAAQ,EAAI,CAAQ,GAAG,WAAW,CAAC,EAC5D,EAAO,EAAU,CAAK,EAE1B,CACD,CAAC,EACD,CAAC,IAAc,EAAI,EAAU,EAAS,EAAI,EAC1C,IAAQ,EAAI,CAAQ,CACrB,EAEE,EAAM,QAAS,EAAQ,EAAgB,EACvC,EAAO,GAAU,CAAQ,EACzB,EAAI,EAaP,IAAe,MAEf,GAAI,eAAe,IAAI,YAAY,GAAK,KAAM,eAAe,OAAO,aAAgB,EAAsB,GAAe,CAAE,QAAS,CAAC,EAAG,KAAM,CAAC,CAAE,EAAG,CAAC,EAAG,CAAC,EAAG,EAAI,CAAC",
  "debugId": "FAA769171A0B5C2664756E2164756E21",
  "names": []
}