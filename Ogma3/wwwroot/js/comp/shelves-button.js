import{a as V}from"./chunk-kfd0zr41.js";import{f as G}from"./chunk-rtz3801n.js";import{i as M,s as Q,t as q,z as F}from"./chunk-7ezcb9bq.js";import"./chunk-81baasv3.js";import{H as N}from"./chunk-584t0j1k.js";import{I as k,J as g,L as S,N as I,O as P,P as h,Q as p,S as b,T as R,X as f,Y as T,Z as C,aa as _,ca as w,fa as L}from"./chunk-c15tkzxp.js";var B=(s,u)=>{let i=(l)=>{let c=s.renderRoot,m=l.composedPath();if(c&&!m.includes(c))u()};I(()=>{document.addEventListener("click",i)}),P(()=>{document.removeEventListener("click",i)})};var D=":host{display:flex;position:relative}.more-shelves{background-color:var(--background);z-index:3;box-shadow:var(--shadow);flex-direction:column;display:flex;position:absolute;top:100%;right:0}.more-shelves button{justify-content:start;margin:0;padding:.5rem}.more-shelves .icon{margin-right:.5rem}.shelf{box-shadow:inset var(--s-col,transparent)0 0 0 3px}";var K=f('<button type=button title="All bookshelves"class="shelf action-btn"><o-icon class=material-icons-outlined icon=lucide:ellipsis-vertical>',!0,!1,!1),U=f("<div class=more-shelves>"),W=f('<button type=button class="shelf action-btn"><o-icon>',!0,!1,!1),X=f('<button type=button class="shelf action-btn"><o-icon class=icon></o-icon><span>',!0,!1,!1),O=(s,u,i,l)=>{let c=s.map((m)=>{if(m.id===i)return{...m,doesContainBook:l};return m});u(c)},Y=(s,{element:u})=>{let[i,l]=k(!1),[c,m]=k(1),[$,{mutate:j}]=S(async()=>{let e=await q(s.storyId);return e.ok?e.data:null}),[y,{mutate:z}]=S(i,async(e)=>{if(e){let t=await Q(s.storyId,c());return t.ok?t.data:null}return null},{initialValue:[]});B(u,()=>l(!1));let x=(e)=>({color:e.color}),A=async(e)=>{let r=[...y(),...$()].some((o)=>o.doesContainBook&&o.id===e),a=await(r?M:F)({storyId:s.storyId,shelfId:e},{RequestVerificationToken:s.csrf});if(a.ok){let{shelfId:o}=a.data;O($(),j,o,!r),O(y(),z,o,!r)}else G.error(a.statusText)};return()=>[p(b,{get each(){return $()},children:(e)=>(()=>{var t=W(),r=t.firstChild;return t.$$click=A,t.$$clickData=e.id,r._$owner=h(),g((n)=>{var a=`Add to ${e.name}`,o=e.doesContainBook&&e.color,v=x(e),d=e.iconName;return a!==n.e&&C(t,"title",n.e=a),o!==n.t&&((n.t=o)!=null?t.style.setProperty("--s-col",o):t.style.removeProperty("--s-col")),n.a=_(r,v,n.a),d!==n.o&&(r.icon=n.o=d),n},{e:void 0,t:void 0,a:void 0,o:void 0}),t})()}),(()=>{var e=K(),t=e.firstChild;return e.$$click=l,e.$$clickData=!i(),t._$owner=h(),e})(),p(R,{get when(){return i()},get children(){var e=U();return w(e,p(b,{get each(){return y()},children:(t)=>(()=>{var r=X(),n=r.firstChild,a=n.nextSibling;return r.$$click=A,r.$$clickData=t.id,n._$owner=h(),w(a,()=>t.name),g((o)=>{var v=`Add to ${t.name}`,d=t.doesContainBook&&t.color,H=x(t),E=t.iconName;return v!==o.e&&C(r,"title",o.e=v),d!==o.t&&((o.t=d)!=null?r.style.setProperty("--s-col",d):r.style.removeProperty("--s-col")),o.a=_(n,H,o.a),E!==o.o&&(n.icon=o.o=E),o},{e:void 0,t:void 0,a:void 0,o:void 0}),r})()})),e}})]};L("o-shelves",{storyId:0,csrf:""},N(Y,V,D));T(["click"]);

//# debugId=C51FB6E65E50B2D764756E2164756E21
