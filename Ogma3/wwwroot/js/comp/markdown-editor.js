import{a as s}from"./chunk-kfd0zr41.js";import{G as j}from"./chunk-ja96ng46.js";import{H as h,I as V,J as X,L as D,M as Z,N as Q,O as W,P as I,R as Y,W as R,X as G,Y as z,ba as k,ea as A}from"./chunk-p9p4607h.js";var M=".toolbar{gap:1px;display:flex}.btn{color:var(--accent);padding:.5rem}.btn .icon::part(icon){width:20px;height:20px}";var P=({text:o})=>{return document.createComment(o)};class $ extends Error{name="NegativeIndexOutOfBoundsError";static build(o,r){return new $(`Negative index "${r}" points to unassignable index "${o.length+r}" in array with length ${o.length}.`)}}var v=(o)=>[new Proxy(()=>o[0](),{get:(r,n)=>o[0][n]}),new Proxy((r)=>o[1](r),{get:(r,n)=>o[1][n]})],l=(o)=>({extend(r,n){if(n)o[1]=(()=>{let[f,e]=r(v(o));return Object.assign(n([Object.assign(o[0],f),Object.assign(o[1],e)]),o[1])})();else r(v(o)).forEach((f,e)=>{Object.assign(o[e],f)});return o[1]=L(o[1]),o}}),L=(o)=>{return new Proxy(o,{apply(r,n,f){if(typeof r!=="function")throw new Error(`Target is not callable, called with ${f.join(", ")}`);return D(()=>r(...f))},get(r,n){if(!(n in r))throw new Error(`Property ${String(n)} does not exist in Target`);return L(r[n])}})},w=(o,r,n)=>Object.fromEntries(n.map((f)=>[f,(...e)=>{let p=o(),m=p[f](...e);return r(p),m}]));var a=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"];function O(o,r){return O.wrap(h(o,r))}O.wrap=(o)=>{return l(o).extend(([r,n])=>[{},{at(f,e){let p=f<0?r().length+f:f;if(p<0)throw $.build(r(),f);let m=[...r()];return m[p]=e,n(m),e},find(f,e){let p=r().findIndex(f);if(p===-1)return;return n.at(p,e),r()[p]},...w(()=>[...r()],n,a)}])};var C=O;function N(o,r,n){return N.wrap(h(o,n),r)}N.wrap=(o,[r,n])=>{if(r)o[0]=Object.assign(r,o[0]);let[f,e]=l(o).extend(()=>[{},{}],([p,m])=>(u)=>{let c=typeof u==="function"?u(p()):u;return n?.(c),m(c)});if("history"in e)e.history([f()]);return[f,e]};function B(o,r){return B.wrap(h(o,r))}B.wrap=(o)=>{return l(o).extend(([r,n])=>[{},{deep:function f(e=[]){return new Proxy(()=>{},{apply(p,m,[u]){let c=typeof u==="function"?u(r()):u;return n(function t(d=r(),x=0){if(x===e.length)return c;return{...d,[e[x]]:t(d[e[x]],x+1)}}()),c},get:(p,m)=>f([...e,m]),has:()=>!0})}()}])};function T(o,r){return T.wrap(h(o,r))}T.wrap=(o)=>{let[r]=o,[n,f]=C([r()]),[e,p]=h(0),m=0,u=()=>{if(m>0)return;if(e()>0)f(n().slice(0,-e())),p(0);f.push(r())};return l(o).extend(([,c])=>[{history:Object.assign(()=>n().slice(0,-e()||void 0),{forward:()=>n().slice(-e()||n().length)})},{history:Object.assign((t)=>{let d=typeof t==="function"?t(r()):t;return p(0),f(d),c.history.ignore(()=>{c(d.at(-1))}),d},{back(){if(e()>=n().length-1)return!1;return p(e()+1),c.history.ignore(()=>{c(n().at(-(e()+1)))}),!0},forward(){if(e()<1)return!1;return p(e()-1),c.history.ignore(()=>{c(n().at(-(e()+1)))}),!0},clear(){p(0);let t=n();return f([r()]),t},ignore(t){m++,t(),m--},batch(t){m++,t(),m--,u()}})}],([c,t])=>(d)=>{let x=typeof d==="function"?d(c()):d,y=t(x);return u(),y})};var E=T;var fr=["set","delete","clear"];function q(o,r){return q.wrap(h(new Map(o),r))}q.wrap=(o)=>{return l(o).extend(([r,n])=>[{},{...w(()=>new Map(r()),n,fr),clear(){n(new Map)}}])};function F(o,r){return F.wrap(h(o,r))}F.wrap=(o)=>{return l(o).extend(([r,n])=>[{},{update(f){return n(()=>({...r(),...typeof f==="function"?f(r()):f})),r()},delete(f){n(({[f]:e,...p})=>p)}}])};function J(o,r){return J.wrap(h(o,r))}J.wrap=(o)=>{let r=o[0]();return l(o).extend(([,n])=>[{},{reset(){n(r)}}])};var cr=["add","delete","clear"];function K(o,r){return K.wrap(h(new Set(o),r))}K.wrap=(o)=>{return l(o).extend(([r,n])=>[{},{...w(()=>new Set(r()),n,cr),clear(){n(new Set)}}])};function U(o,r){return U.wrap(h(o,r))}U.wrap=(o)=>{return l(o).extend(([r,n])=>{let f=(m,u)=>{let c=Object.entries(u);return r()[m]((t)=>c.every(([d,x])=>t[d]===x))},e=(m,u)=>{if(m===-1)return;let c=r();return n([...c.slice(0,m),u,...c.slice(m+1)]),r()[m]},p=(m,u)=>{let c=Object.entries(m),t=r().map((d)=>c.every(([x,y])=>d[x]===y)?u(d):d);n(t)};return[{findBy(m){return f("find",m)},findManyBy(m){return f("filter",m)},findIndexBy(m){return f("findIndex",m)}},{by(m,u){let c=r.findIndexBy(m);return e(c,u)},manyBy(m,u){return p(m,()=>u)},update(m,u){let c=m<0?r().length-m:m;if(c<0)throw $.build(r(),m);let t=[...r()];return t[c]={...t[c],...u},n(t),t[c]},updateBy(m,u){let c=r.findIndexBy(m);return e(c,{...r()[c],...u})},updateManyBy(m,u){return p(m,(c)=>({...c,...u}))}}]})};var dr=R("<nav class=toolbar>"),tr=R('<button type=button class="btn action-btn"><o-icon class=icon>',!0,!1,!1),xr=[{name:"bold",icon:"lucide:bold",prefix:"**",suffix:"**"},{name:"italic",icon:"lucide:italic",prefix:"*",suffix:"*"},{name:"strikethrough",icon:"lucide:strikethrough",prefix:"~~",suffix:"~~"},{name:"link",icon:"lucide:link",prefix:"[",suffix:"](url)"},{name:"spoiler",icon:"lucide:eye-closed",prefix:"||",suffix:"||"}],g="markdown-editor",lr=(o)=>typeof o==="object"&&("nodeName"in o)&&(o.nodeName==="TEXTAREA"||o.nodeName==="INPUT"),hr=({selector:o,overrideSelector:r})=>{let n=r?o:`${g} + ${o}`,f=document.querySelector(n);if(!f)throw Error(`Element "${o}" not found`);if(!lr(f))throw Error(`Element "${o}" is not a textarea or input`);let[e,p]=E(0),[m,u]=E(f.value);X(()=>{f.value=m()});let c=(d)=>{if(m.history().length<=1)return!1;if(d.ctrlKey&&d.key==="z"){u.history.back();let x=e.history().at(-1);return f.setSelectionRange(x,x),p.history.back(),!0}};Z(()=>{f.addEventListener("keydown",c)}),Q(()=>{f.removeEventListener("keydown",c)});let t=({prefix:d,suffix:x})=>{let{selectionStart:y,selectionEnd:i}=f,b=f.value.substring(y,i),_=`${d}${b}${x}`;f.setRangeText(_,y,i,"preserve"),f.selectionStart=y+d.length,f.selectionEnd=i+d.length,u(f.value),p(i),f.focus(),f.dispatchEvent(new Event("input"))};return(()=>{var d=dr();return k(d,I(P,{text:n}),null),k(d,I(Y,{each:xr,children:(x)=>(()=>{var y=tr(),i=y.firstChild;return y.$$click=t,y.$$clickData=x,i._$owner=W(),V((b)=>{var{name:_,icon:H}=x;return _!==b.e&&z(y,"title",b.e=_),H!==b.t&&(i.icon=b.t=H),b},{e:void 0,t:void 0}),y})()}),null),d})()};A(g,{selector:"textarea",overrideSelector:!1},j(hr,s,M));G(["click"]);export{hr as MarkdownEditor};

//# debugId=4E95A34C5CBB27BF64756E2164756E21
